!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=global.window&&global.window.$?t(global.window.$):function(e){if(!e.$&&!e.fn)throw new Error("Tokenfield requires a window object with jQuery or a jQuery instance");return t(e.$||e)}:t(jQuery,window)}(function($,t){"use strict";var e=function(e,i){var n=this;this.$element=$(e),this.textDirection=this.$element.css("direction"),this.options=$.extend(!0,{},$.fn.tokenfield.defaults,{tokens:this.$element.val()},this.$element.data(),i),this._delimiters="string"==typeof this.options.delimiter?[this.options.delimiter]:this.options.delimiter,this._triggerKeys=$.map(this._delimiters,function(t){return t.charCodeAt(0)}),this._firstDelimiter=this._delimiters[0];var s=$.inArray(" ",this._delimiters),r=$.inArray("-",this._delimiters);s>=0&&(this._delimiters[s]="\\s"),r>=0&&(delete this._delimiters[r],this._delimiters.unshift("-"));var a=["\\","$","[","{","^",".","|","?","*","+","(",")"];$.each(this._delimiters,function(t,e){var i=$.inArray(e,a);i>=0&&(n._delimiters[t]="\\"+e)});var o=t&&"function"==typeof t.getMatchedCSSRules?t.getMatchedCSSRules(e):null,p=e.style.width,h,l=this.$element.width();o&&$.each(o,function(t,e){e.style.width&&(h=e.style.width)});var u="rtl"===$("body").css("direction")?"right":"left",d={position:this.$element.css("position")};d[u]=this.$element.css(u),this.$element.data("original-styles",d).data("original-tabindex",this.$element.prop("tabindex")).css("position","absolute").css(u,"-10000px").prop("tabindex",-1),this.$wrapper=$('<div class="tokenfield form-control" />'),this.$element.hasClass("input-lg")&&this.$wrapper.addClass("input-lg"),this.$element.hasClass("input-sm")&&this.$wrapper.addClass("input-sm"),"rtl"===this.textDirection&&this.$wrapper.addClass("rtl");var c=this.$element.prop("id")||(new Date).getTime()+""+Math.floor(100*(1+Math.random()));this.$input=$('<input type="'+this.options.inputType+'" class="token-input" autocomplete="off" />').appendTo(this.$wrapper).prop("placeholder",this.$element.prop("placeholder")).prop("id",c+"-tokenfield").prop("tabindex",this.$element.data("original-tabindex"));var f=$('label[for="'+this.$element.prop("id")+'"]');if(f.length&&f.prop("for",this.$input.prop("id")),this.$copyHelper=$('<input type="text" />').css("position","absolute").css(u,"-10000px").prop("tabindex",-1).prependTo(this.$wrapper),p?this.$wrapper.css("width",p):h?this.$wrapper.css("width",h):this.$element.parents(".form-inline").length&&this.$wrapper.width(l),(this.$element.prop("disabled")||this.$element.parents("fieldset[disabled]").length)&&this.disable(),this.$element.prop("readonly")&&this.readonly(),this.$mirror=$('<span style="position:absolute; top:-999px; left:0; white-space:pre;"/>'),this.$input.css("min-width",this.options.minWidth+"px"),$.each(["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent"],function(t,e){n.$mirror[0].style[e]=n.$input.css(e)}),this.$mirror.appendTo("body"),this.$wrapper.insertBefore(this.$element),this.$element.prependTo(this.$wrapper),this.update(),this.setTokens(this.options.tokens,!1,!this.$element.val()&&this.options.tokens),this.listen(),!$.isEmptyObject(this.options.autocomplete)){var v="rtl"===this.textDirection?"right":"left",m=$.extend({minLength:this.options.showAutocompleteOnFocus?0:null,position:{my:v+" top",at:v+" bottom",of:this.$wrapper}},this.options.autocomplete);this.$input.autocomplete(m)}if(!$.isEmptyObject(this.options.typeahead)){var g=this.options.typeahead,k={minLength:this.options.showAutocompleteOnFocus?0:null},y=$.isArray(g)?g:[g,g];y[0]=$.extend({},k,y[0]),this.$input.typeahead.apply(this.$input,y),this.typeahead=!0}};e.prototype={constructor:e,createToken:function(t,e){var i=this;if(t="string"==typeof t?{value:t,label:t}:$.extend({},t),"undefined"==typeof e&&(e=!0),t.value=$.trim(t.value.toString()),t.label=t.label&&t.label.length?$.trim(t.label):t.value,!(!t.value.length||!t.label.length||t.label.length<=this.options.minLength||this.options.limit&&this.getTokens().length>=this.options.limit)){var n=$.Event("tokenfield:createtoken",{attrs:t});if(this.$element.trigger(n),n.attrs&&!n.isDefaultPrevented()){var s=$('<div class="token" />').append('<span class="token-label" />').append('<a href="#" class="close" tabindex="-1">&times;</a>').data("attrs",t);this.$input.hasClass("tt-input")?this.$input.parent().before(s):this.$input.before(s),this.$input.css("width",this.options.minWidth+"px");var r=s.find(".token-label"),a=s.find(".close");this.maxTokenWidth||(this.maxTokenWidth=this.$wrapper.width()-a.outerWidth()-parseInt(a.css("margin-left"),10)-parseInt(a.css("margin-right"),10)-parseInt(s.css("border-left-width"),10)-parseInt(s.css("border-right-width"),10)-parseInt(s.css("padding-left"),10)-parseInt(s.css("padding-right"),10),parseInt(r.css("border-left-width"),10)-parseInt(r.css("border-right-width"),10)-parseInt(r.css("padding-left"),10)-parseInt(r.css("padding-right"),10),parseInt(r.css("margin-left"),10)-parseInt(r.css("margin-right"),10)),r.css("max-width",this.maxTokenWidth),this.options.html?r.html(t.label):r.text(t.label),s.on("mousedown",function(t){return i._disabled||i._readonly?!1:void(i.preventDeactivation=!0)}).on("click",function(t){return i._disabled||i._readonly?!1:(i.preventDeactivation=!1,t.ctrlKey||t.metaKey?(t.preventDefault(),i.toggle(s)):void i.activate(s,t.shiftKey,t.shiftKey))}).on("dblclick",function(t){return i._disabled||i._readonly||!i.options.allowEditing?!1:void i.edit(s)}),a.on("click",$.proxy(this.remove,this)),this.$element.trigger($.Event("tokenfield:createdtoken",{attrs:t,relatedTarget:s.get(0)})),e&&this.$element.val(this.getTokensList()).trigger($.Event("change",{initiator:"tokenfield"}));var i=this;return setTimeout(function(){i.update()},0),this.$element.get(0)}}},setTokens:function(t,e,i){if(e||this.$wrapper.find(".token").remove(),t){"undefined"==typeof i&&(i=!0),"string"==typeof t&&(t=this._delimiters.length?t.split(new RegExp("["+this._delimiters.join("")+"]")):[t]);var n=this;return $.each(t,function(t,e){n.createToken(e,i)}),this.$element.get(0)}},getTokenData:function(t){var e=t.map(function(){var t=$(this);return t.data("attrs")}).get();return 1==e.length&&(e=e[0]),e},getTokens:function(t){var e=this,i=[],n=t?".active":"";return this.$wrapper.find(".token"+n).each(function(){i.push(e.getTokenData($(this)))}),i},getTokensList:function(t,e,i){t=t||this._firstDelimiter,e="undefined"!=typeof e&&null!==e?e:this.options.beautify;var n=t+(e&&" "!==t?" ":"");return $.map(this.getTokens(i),function(t){return t.value}).join(n)},getInput:function(){return this.$input.val()},setInput:function(t){this.$input.hasClass("tt-input")?this.$input.typeahead("val",t):this.$input.val(t)},listen:function(){var e=this;this.$element.on("change",$.proxy(this.change,this)),this.$wrapper.on("mousedown",$.proxy(this.focusInput,this)),this.$input.on("focus",$.proxy(this.focus,this)).on("blur",$.proxy(this.blur,this)).on("paste",$.proxy(this.paste,this)).on("keydown",$.proxy(this.keydown,this)).on("keypress",$.proxy(this.keypress,this)).on("keyup",$.proxy(this.keyup,this)),this.$copyHelper.on("focus",$.proxy(this.focus,this)).on("blur",$.proxy(this.blur,this)).on("keydown",$.proxy(this.keydown,this)).on("keyup",$.proxy(this.keyup,this)),this.$input.on("keypress",$.proxy(this.update,this)).on("keyup",$.proxy(this.update,this)),this.$input.on("autocompletecreate",function(){var t=$(this).data("ui-autocomplete").menu.element,i=e.$wrapper.outerWidth()-parseInt(t.css("border-left-width"),10)-parseInt(t.css("border-right-width"),10);t.css("min-width",i+"px")}).on("autocompleteselect",function(t,i){return e.createToken(i.item)&&(e.$input.val(""),e.$input.data("edit")&&e.unedit(!0)),!1}).on("typeahead:selected typeahead:autocompleted",function(t,i,n){e.createToken(i)&&(e.$input.typeahead("val",""),e.$input.data("edit")&&e.unedit(!0))}),$(t).on("resize",$.proxy(this.update,this))},keydown:function(t){function e(e){if(n.$input.is(document.activeElement)){if(n.$input.val().length>0)return;e+="All";var i=n.$input.hasClass("tt-input")?n.$input.parent()[e](".token:first"):n.$input[e](".token:first");if(!i.length)return;n.preventInputFocus=!0,n.preventDeactivation=!0,n.activate(i),t.preventDefault()}else n[e](t.shiftKey),t.preventDefault()}function i(e){if(t.shiftKey){if(n.$input.is(document.activeElement)){if(n.$input.val().length>0)return;var i=n.$input.hasClass("tt-input")?n.$input.parent()[e+"All"](".token:first"):n.$input[e+"All"](".token:first");if(!i.length)return;n.activate(i)}var s="prev"===e?"next":"prev",r="prev"===e?"first":"last";n.$firstActiveToken[s+"All"](".token").each(function(){n.deactivate($(this))}),n.activate(n.$wrapper.find(".token:"+r),!0,!0),t.preventDefault()}}if(this.focused){var n=this;switch(t.keyCode){case 8:if(!this.$input.is(document.activeElement))break;this.lastInputValue=this.$input.val();break;case 37:e("rtl"===this.textDirection?"next":"prev");break;case 38:i("prev");break;case 39:e("rtl"===this.textDirection?"prev":"next");break;case 40:i("next");break;case 65:if(this.$input.val().length>0||!t.ctrlKey&&!t.metaKey)break;this.activateAll(),t.preventDefault();break;case 9:case 13:if(this.$input.data("ui-autocomplete")&&this.$input.data("ui-autocomplete").menu.element.find("li:has(a.ui-state-focus), li.ui-state-focus").length)break;if(this.$input.hasClass("tt-input")&&this.$wrapper.find(".tt-cursor").length)break;if(this.$input.hasClass("tt-input")&&this.$wrapper.find(".tt-hint").val()&&this.$wrapper.find(".tt-hint").val().length)break;if(this.$input.is(document.activeElement)&&this.$input.val().length||this.$input.data("edit"))return this.createTokensFromInput(t,this.$input.data("edit"));if(13===t.keyCode){if(!this.$copyHelper.is(document.activeElement)||1!==this.$wrapper.find(".token.active").length)break;if(!n.options.allowEditing)break;this.edit(this.$wrapper.find(".token.active"))}}this.lastKeyDown=t.keyCode}},keypress:function(t){return-1!==$.inArray(t.which,this._triggerKeys)&&this.$input.is(document.activeElement)?(this.$input.val()&&this.createTokensFromInput(t),!1):void 0},keyup:function(t){if(this.preventInputFocus=!1,this.focused){switch(t.keyCode){case 8:if(this.$input.is(document.activeElement)){if(this.$input.val().length||this.lastInputValue.length&&8===this.lastKeyDown)break;this.preventDeactivation=!0;var e=this.$input.hasClass("tt-input")?this.$input.parent().prevAll(".token:first"):this.$input.prevAll(".token:first");if(!e.length)break;this.activate(e)}else this.remove(t);break;case 46:this.remove(t,"next")}this.lastKeyUp=t.keyCode}},focus:function(t){this.focused=!0,this.$wrapper.addClass("focus"),this.$input.is(document.activeElement)&&(this.$wrapper.find(".active").removeClass("active"),this.$firstActiveToken=null,this.options.showAutocompleteOnFocus&&this.search())},blur:function(t){this.focused=!1,this.$wrapper.removeClass("focus"),this.preventDeactivation||this.$element.is(document.activeElement)||(this.$wrapper.find(".active").removeClass("active"),this.$firstActiveToken=null),!this.preventCreateTokens&&(this.$input.data("edit")&&!this.$input.is(document.activeElement)||this.options.createTokensOnBlur)&&this.createTokensFromInput(t),this.preventDeactivation=!1,this.preventCreateTokens=!1},paste:function(t){var e=this;e.options.allowPasting&&setTimeout(function(){e.createTokensFromInput(t)},1)},change:function(t){"tokenfield"!==t.initiator&&this.setTokens(this.$element.val())},createTokensFromInput:function(t,e){if(!(this.$input.val().length<this.options.minLength)){var i=this.getTokensList();return this.setTokens(this.$input.val(),!0),i==this.getTokensList()&&this.$input.val().length?!1:(this.setInput(""),this.$input.data("edit")&&this.unedit(e),!1)}},next:function(t){if(t){var e=this.$wrapper.find(".active:first"),i=e&&this.$firstActiveToken?e.index()<this.$firstActiveToken.index():!1;if(i)return this.deactivate(e)}var n=this.$wrapper.find(".active:last"),s=n.nextAll(".token:first");return s.length?void this.activate(s,t):void this.$input.focus()},prev:function(t){if(t){var e=this.$wrapper.find(".active:last"),i=e&&this.$firstActiveToken?e.index()>this.$firstActiveToken.index():!1;if(i)return this.deactivate(e)}var n=this.$wrapper.find(".active:first"),s=n.prevAll(".token:first");return s.length||(s=this.$wrapper.find(".token:first")),s.length||t?void this.activate(s,t):void this.$input.focus()},activate:function(t,e,i,n){if(t){if("undefined"==typeof n)var n=!0;if(i)var e=!0;if(this.$copyHelper.focus(),e||(this.$wrapper.find(".active").removeClass("active"),n?this.$firstActiveToken=t:delete this.$firstActiveToken),i&&this.$firstActiveToken){var s=this.$firstActiveToken.index()-2,r=t.index()-2,a=this;this.$wrapper.find(".token").slice(Math.min(s,r)+1,Math.max(s,r)).each(function(){a.activate($(this),!0)})}t.addClass("active"),this.$copyHelper.val(this.getTokensList(null,null,!0)).select()}},activateAll:function(){var t=this;this.$wrapper.find(".token").each(function(e){t.activate($(this),0!==e,!1,!1)})},deactivate:function(t){t&&(t.removeClass("active"),this.$copyHelper.val(this.getTokensList(null,null,!0)).select())},toggle:function(t){t&&(t.toggleClass("active"),this.$copyHelper.val(this.getTokensList(null,null,!0)).select())},edit:function(t){if(t){var e=t.data("attrs"),i={attrs:e,relatedTarget:t.get(0)},n=$.Event("tokenfield:edittoken",i);if(this.$element.trigger(n),!n.isDefaultPrevented()){t.find(".token-label").text(e.value);var s=t.outerWidth(),r=this.$input.hasClass("tt-input")?this.$input.parent():this.$input;t.replaceWith(r),this.preventCreateTokens=!0,this.$input.val(e.value).select().data("edit",!0).width(s),this.update(),this.$element.trigger($.Event("tokenfield:editedtoken",i))}}},unedit:function(t){var e=this.$input.hasClass("tt-input")?this.$input.parent():this.$input;if(e.appendTo(this.$wrapper),this.$input.data("edit",!1),this.$mirror.text(""),this.update(),t){var i=this;setTimeout(function(){i.$input.focus()},1)}},remove:function(t,e){if(!(this.$input.is(document.activeElement)||this._disabled||this._readonly)){var i="click"===t.type?$(t.target).closest(".token"):this.$wrapper.find(".token.active");if("click"!==t.type){if(!e)var e="prev";if(this[e](),"prev"===e)var n=0===i.first().prevAll(".token:first").length}var s={attrs:this.getTokenData(i),relatedTarget:i.get(0)},r=$.Event("tokenfield:removetoken",s);if(this.$element.trigger(r),!r.isDefaultPrevented()){var a=$.Event("tokenfield:removedtoken",s),o=$.Event("change",{initiator:"tokenfield"});i.remove(),this.$element.val(this.getTokensList()).trigger(a).trigger(o),(!this.$wrapper.find(".token").length||"click"===t.type||n)&&this.$input.focus(),this.$input.css("width",this.options.minWidth+"px"),this.update(),t.preventDefault(),t.stopPropagation()}}},update:function(t){var e=this.$input.val(),i=parseInt(this.$input.css("padding-left"),10),n=parseInt(this.$input.css("padding-right"),10),s=i+n;if(this.$input.data("edit")){if(e||(e=this.$input.prop("placeholder")),e===this.$mirror.text())return;this.$mirror.text(e);var r=this.$mirror.width()+10;if(r>this.$wrapper.width())return this.$input.width(this.$wrapper.width());this.$input.width(r)}else{this.$input.width(this.options.minWidth);var a="rtl"===this.textDirection?this.$input.offset().left+this.$input.outerWidth()-this.$wrapper.offset().left-parseInt(this.$wrapper.css("padding-left"),10)-s-1:this.$wrapper.offset().left+this.$wrapper.width()+parseInt(this.$wrapper.css("padding-left"),10)-this.$input.offset().left-s;this.$input.width(isNaN(a)?"100%":a)}},focusInput:function(t){if(!($(t.target).closest(".token").length||$(t.target).closest(".token-input").length||$(t.target).closest(".tt-dropdown-menu").length)){var e=this;setTimeout(function(){e.$input.focus()},0)}},search:function(){this.$input.data("ui-autocomplete")&&this.$input.autocomplete("search")},disable:function(){this.setProperty("disabled",!0)},enable:function(){this.setProperty("disabled",!1)},readonly:function(){this.setProperty("readonly",!0)},writeable:function(){this.setProperty("readonly",!1)},setProperty:function(t,e){this["_"+t]=e,this.$input.prop(t,e),this.$element.prop(t,e),this.$wrapper[e?"addClass":"removeClass"](t)},destroy:function(){this.$element.val(this.getTokensList()),this.$element.css(this.$element.data("original-styles")),this.$element.prop("tabindex",this.$element.data("original-tabindex"));var t=$('label[for="'+this.$input.prop("id")+'"]');t.length&&t.prop("for",this.$element.prop("id")),this.$element.insertBefore(this.$wrapper),this.$element.removeData("original-styles").removeData("original-tabindex").removeData("bs.tokenfield"),this.$wrapper.remove(),this.$mirror.remove();var e=this.$element;return e}};var i=$.fn.tokenfield;return $.fn.tokenfield=function(t,i){var n,s=[];Array.prototype.push.apply(s,arguments);var r=this.each(function(){var r=$(this),a=r.data("bs.tokenfield"),o="object"==typeof t&&t;"string"==typeof t&&a&&a[t]?(s.shift(),n=a[t].apply(a,s)):a||"string"==typeof t||i||(r.data("bs.tokenfield",a=new e(this,o)),r.trigger("tokenfield:initialize"))});return"undefined"!=typeof n?n:r},$.fn.tokenfield.defaults={minWidth:60,minLength:0,html:!0,allowEditing:!0,allowPasting:!0,limit:0,autocomplete:{},typeahead:{},showAutocompleteOnFocus:!1,createTokensOnBlur:!1,delimiter:",",beautify:!0,inputType:"text"},$.fn.tokenfield.Constructor=e,$.fn.tokenfield.noConflict=function(){return $.fn.tokenfield=i,this},e});